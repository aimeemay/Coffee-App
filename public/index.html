<!DOCTYPE html>
<head>
  <script>
    ENV = { ENABLE_ALL_FEATURES: true };
  </script>
  <script src="js/libs/jquery-1.9.1.js"></script>
  <script src="js/libs/jquery.swipebox.min.js"></script>
  <script src="js/libs/handlebars.js"></script>
  <script src="js/libs/moment.min.js"></script>
  <script src="js/libs/ember.js"></script>
  <script src="js/libs/ember-data.js"></script>
  <script src="js/coffeeinfo.js"></script>
  <script src="js/app.js"></script>
  <link rel="stylesheet" type="text/css" href="css/style.css" media="screen" />
  <link rel="stylesheet" href="css/swipebox.min.css">
  <meta charset="utf-8">
  <title>Menu</title>
</head>
<body>
  <script>
  $(function(){
    $.get('/isloggedin', function (data) {
     
     // only actually logged in if: data.uservalid === true
     // time in milisecond: data.timeleft

     var timeleft = parseInt(data.timeleft / 1000); // stored in sec 
     updateTime();
    


    var loginInterval = setInterval(function(){
      --timeleft; // Reduce time by one
      updateTime();
      if (timeleft === 0) {
        clearInterval(loginInterval);
        alert('You have been logged out!')
      }
    },1000)

    function updateTime() {
      var totalSec = timeleft;
      var hours = parseInt( totalSec / 3600 ) % 24;
      var minutes = parseInt( totalSec / 60 ) % 60;
      var seconds = totalSec % 60;
      var result = (minutes < 10 ? "0" + minutes : minutes) + "min " + (seconds  < 10 ? "0" + seconds : seconds) + " sec";
     if (data.uservalid) $('title').html('Menu | ' + result);
    }


    })
  })
  </script>


  <script type="text/x-handlebars" data-template-name='application'>
    <div class='container'>
      {{outlet}}
    </div>
  </script>

  <script type="text/x-handlebars" data-template-name='index'>
    <header>
      <h1>{{#link-to 'Coffees'}}Landing Page{{/link-to}}</h1>
    </header>

    <form action="/login" method="post">
      <div>
          <label>Username:</label>
          <input type="text" name="username"/>
      </div>
      <div>
          <label>Password:</label>
          <input type="password" name="password"/>
      </div>
      <div>
          <label>Session Time</label>
          <select name="session">
              <option value='1'>1 min</option>
              <option value='10'>10 min</option>
              <option value='15'>15 min</option>
              <option value='30'>30 min</option>
              <option value='60'>1 hour</option>
              <!--<option value='6000000'>Forever</option>-->
          </select>
      </div>

      <div>
          <input type="submit" value="Log In"/>
      </div>
    </form>
  </script>

  <script type="text/x-handlebars" data-template-name='Coffees'>
    <header>
      <h1>THE REAL COFFEE MENU</h1>
    </header>
    <div id='sort'>
      {{#link-to 'Coffees' (query-params sort="price") tagName='div' class='button link'}}Sort By Price{{/link-to}}
      {{#link-to 'Coffees' (query-params sort="name") tagName='div' class='button link'}}Sort By Name{{/link-to}}
      {{!-- <a href="#" {{action sort 'sortfunction'}}> Sort by Name</a> --}}
    </div>
    {{#each .}}
        {{#link-to 'Coffee' this tagName='div' class='coffees link box'}}
          <img {{bind-attr src='image'}} class='w45'/>
          <div class='w50 text'>
            <h2>{{name}}</h2>
            <p>{{short_description}}</p>
            <p>Price: {{price}}</p>
          </div>
          <div class='w5 arrow'>
            >
          </div>

        {{/link-to}}
    {{/each}}
  </script>

  <script type="text/x-handlebars" data-template-name='Coffee'>
    <header>
      <h1>{{#link-to 'Coffees'}}<{{/link-to}} {{name}}</h1>
    </header>
    <nav id='coffeeNav' class='link'>
      <ul>
        {{#link-to 'Coffee' tagName='li'}}Overview{{/link-to}}{{#link-to 'Gallery' tagName='li'}}Gallery{{/link-to}}{{#link-to 'Reviews' tagName='li'}}Reviews{{/link-to}}</li>
      </ul>
    </nav>

    {{outlet}}
  </script>

  <script type="text/x-handlebars" data-template-name='Coffee/index'>
    <div id='Overview'>
      <div class='coffeeOverview box'>
        <h2>Overview</h2>
        <div>
          <p>{{short_description}}</p>
          <p>Price: {{price}}</p>
        </div>
        <img {{bind-attr src='image' alt='title'}}/>
      </div>
      <div class='coffeeDesc box'>
        <h2>Description</h2>
        <p>{{long_description}}</p>
      </div>
      <div class='whoDrinks box'>
        <h2>Who drinks it?</h2>
        <p>{{who_drinks_it}}</p>
      </div>
      <div class='howDrinks box'>
        <h2>How to Drink</h2>
        <p>{{how_to_drink}}</p>
      </div>
    </div>
  </script>

  <script type="text/x-handlebars" data-template-name='Gallery'>
    <div class='box'>
      <h2>Gallery</h2>
      <p>Gallery of {{name}}s that fellow coffee sippers have uploaded</p>
      <div id='gallery'>
      {{#each gallery}}
       <a {{bind-attr href='this' }} class="swipebox" title="{{../name}}">
                <img {{bind-attr src='this'}}>
        </a>
      {{/each}}
      </div>
    </div>
  </script>

  <script type="text/x-handlebars" data-template-name='Reviews'>
    <div class='reviews box'>
      <h2>Reviews</h2>
      <p>Coming Soon...</p>
    </div>
  </script>

</body>
</html>